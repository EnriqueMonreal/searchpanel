(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=1)})([function(module,exports,__webpack_require__){"use strict";var namespace=function namespace(_namespace){return function(target){var namespaceArray=_namespace.split(".");var constructObject=function constructObject(namespaceArray,obj){if(namespaceArray.length>0){var name=namespaceArray[0];if(!obj[name]){obj[name]={}}constructObject(namespaceArray.splice(1),obj[name])}else{obj[target.name]=target}return obj};var mainPath=namespaceArray[0];if(!window[mainPath]){window[mainPath]={}}constructObject(namespaceArray.splice(1),window[mainPath])}};module.exports=namespace},function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _dec,_class;var _decorator=__webpack_require__(0);var _decorator2=_interopRequireDefault(_decorator);var _drawingControl=__webpack_require__(2);var _drawingControl2=_interopRequireDefault(_drawingControl);var _drawing=__webpack_require__(4);var _drawing2=_interopRequireDefault(_drawing);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Drawing=(_dec=(0,_decorator2.default)("M.plugin"),_dec(_class=function(_M$Plugin){_inherits(Drawing,_M$Plugin);_createClass(Drawing,null,[{key:"NAME",get:function get(){return"Drawing"}}]);function Drawing(parameters){_classCallCheck(this,Drawing);parameters=parameters||{};var _this=_possibleConstructorReturn(this,(Drawing.__proto__||Object.getPrototypeOf(Drawing)).call(this,parameters));_this.map_=null;_this.control_=null;_this.panel_=null;_this.params_={};if(!M.utils.isNullOrEmpty(parameters.params)){_this.params_=parameters.params}_this.options_={};if(!M.utils.isNullOrEmpty(parameters.options)){_this.options_=parameters.options}return _this}_createClass(Drawing,[{key:"addTo",value:function addTo(map){var _this2=this;this.map_=map;this.control_=new M.control.DrawingControl;this.panel_=new M.ui.Panel("drawing",{collapsible:true,className:"m-drawing",collapsedButtonClass:"g-cartografia-editar",position:M.ui.position.TR,tooltip:"Herramienta de dibujo"});this.panel_.on(M.evt.ADDED_TO_MAP,function(html){M.utils.enableTouchScroll(html)});this.panel_.addControls(this.control_);this.map_.addPanels(this.panel_);this.control_.on(M.evt.ADDED_TO_MAP,function(){_this2.fire(M.evt.ADDED_TO_MAP)})}},{key:"destroy",value:function destroy(){this.map_.removeControls([this.control_]);this.map_=null;this.control_=null;this.panel_=null;this.options_=null}},{key:"equals",value:function equals(plugin){if(plugin instanceof Drawing){return true}else{return false}}}]);return Drawing}(M.Plugin))||_class)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DrawingControl=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _dec,_class;var _decorator=__webpack_require__(0);var _decorator2=_interopRequireDefault(_decorator);var _drawingControl=__webpack_require__(3);var _drawingControl2=_interopRequireDefault(_drawingControl);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DrawingControl=exports.DrawingControl=(_dec=(0,_decorator2.default)("M.control"),_dec(_class=function(_M$Control){_inherits(DrawingControl,_M$Control);_createClass(DrawingControl,null,[{key:"NAME",get:function get(){return"drawing"}},{key:"TEMPLATE",get:function get(){return"drawing.html"}}]);function DrawingControl(){_classCallCheck(this,DrawingControl);if(M.utils.isUndefined(M.impl.control.DrawingControl)){M.exception("La implementaciÃ³n usada no puede crear controles DrawingControl")}var impl=new M.impl.control.DrawingControl;var _this=_possibleConstructorReturn(this,(DrawingControl.__proto__||Object.getPrototypeOf(DrawingControl)).call(this,impl,"Drawing"));_this.actionsButtons_=null;_this.geometryButtons_=null;_this.drawContainer_=null;return _this}_createClass(DrawingControl,[{key:"addEvents",value:function addEvents(html){var _this2=this;this.actionsButtons_=html.querySelectorAll(".buttons.tools > button");this.geometryButtons_=html.querySelectorAll(".buttons.geometry > button");this.drawContainer_=html.querySelector(".geometry-selector");this.actionsButtons_.forEach(function(element){element.addEventListener("click",function(evt){return _this2.toggleActionButton(evt)})});this.geometryButtons_.forEach(function(element){element.addEventListener("click",function(evt){return _this2.changeGeometryButton(evt)})})}},{key:"createView",value:function createView(map){var _this3=this;return new Promise(function(success,fail){M.template.compile(DrawingControl.TEMPLATE,{vars:{crs:_this3.crsOptions_,provincias:_this3.provincias_}}).then(function(html){_this3.addEvents(html);success(html)})})}},{key:"toggleActionButton",value:function toggleActionButton(evt){evt=evt||window.event;var itemTarget=evt.target;var impl=this.getImpl();var active=itemTarget.classList.contains("active");this.deactiveAll();switch(itemTarget.dataset.type){case"draw":if(!active){itemTarget.classList.add("active");this.deactiveConflictedPlugins();impl.activateDraw();this.drawContainer_.classList.remove("dnone")}break;case"modify":if(!active){itemTarget.classList.add("active");this.deactiveConflictedPlugins();impl.activateModify()}break;case"remove":if(!active){itemTarget.classList.add("active");this.deactiveConflictedPlugins();impl.activateRemove()}break;case"removeall":impl.clearLayer();break;case"save":impl.saveAsKML();break;default:break}}},{key:"deactiveAll",value:function deactiveAll(){this.getImpl().deactivateAllActions();this.drawContainer_.classList.add("dnone");this.actionsButtons_.forEach(function(button){button.classList.remove("active")})}},{key:"changeGeometryButton",value:function changeGeometryButton(evt){evt=evt||window.event;var itemTarget=evt.target;var active=itemTarget.classList.contains("active");if(!active){this.geometryButtons_.forEach(function(button){button.classList.remove("active")});itemTarget.classList.add("active");this.getImpl().changeGeometryType(itemTarget.dataset.type)}}},{key:"deactiveConflictedPlugins",value:function deactiveConflictedPlugins(){var conflictedPlugins=["measurebar","featureinfo"];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.map_.getPanels(conflictedPlugins)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var panel=_step.value;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=panel.getControls()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var control=_step2.value;control.deactivate()}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"equals",value:function equals(obj){var equals=false;if(obj instanceof DrawingControl){equals=this.name===obj.name}return equals}}]);return DrawingControl}(M.Control))||_class)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DrawingControl=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _dec,_class;var _decorator=__webpack_require__(0);var _decorator2=_interopRequireDefault(_decorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DrawingControl=exports.DrawingControl=(_dec=(0,_decorator2.default)("M.impl.control"),_dec(_class=function(_M$impl$Control){_inherits(DrawingControl,_M$impl$Control);function DrawingControl(){_classCallCheck(this,DrawingControl);var _this=_possibleConstructorReturn(this,(DrawingControl.__proto__||Object.getPrototypeOf(DrawingControl)).call(this));_this.type_="Point";_this.features_=new ol.Collection;_this.layer_=_this.createLayer_();_this.draw_=_this.createInteractionDraw_();_this.modify_=_this.createInteractionModify_();_this.remove_=_this.createInteractionSelect_();return _this}_createClass(DrawingControl,[{key:"addTo",value:function addTo(map,html){this.facadeMap_=map;this.element=html;map.getMapImpl().addLayer(this.layer_);var olMap=map.getMapImpl();ol.control.Control.call(this,{element:html,target:null});olMap.addControl(this)}},{key:"activate",value:function activate(){}},{key:"deactivate",value:function deactivate(){}},{key:"createLayer_",value:function createLayer_(){return new ol.layer.Vector({source:new ol.source.Vector({features:this.features_}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 209, 128, 0.3)"}),stroke:new ol.style.Stroke({color:"#FB8C00",width:3}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#FB8C00"})})}),zIndex:M.impl.Map.Z_INDEX[M.layer.type.WFS]+99})}},{key:"createInteractionDraw_",value:function createInteractionDraw_(){return new ol.interaction.Draw({source:this.layer_.getSource(),type:this.type_,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 209, 128, 0.2)"}),stroke:new ol.style.Stroke({color:"#FB8C00",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgb(0, 0, 0)"})})})})}},{key:"createInteractionModify_",value:function createInteractionModify_(){return new ol.interaction.Modify({features:this.features_})}},{key:"createInteractionSelect_",value:function createInteractionSelect_(){return new ol.interaction.Select({condition:ol.events.condition.pointerMove,layers:[this.layer_]})}},{key:"clearLayer",value:function clearLayer(){if(!M.utils.isNullOrEmpty(this.layer_)){this.layer_.getSource().clear()}}},{key:"changeGeometryType",value:function changeGeometryType(type){this.type_=type;this.deactivateDraw();this.draw_=this.createInteractionDraw_();this.activateDraw()}},{key:"deactivateAllActions",value:function deactivateAllActions(){this.deactivateDraw();this.deactivateModify();this.deactivateRemove()}},{key:"removeOnClick_",value:function removeOnClick_(evt){var _this2=this;var selectedFeatures=this.facadeMap_.getMapImpl().forEachFeatureAtPixel(evt.vendor.pixel,function(feature){_this2.layer_.getSource().removeFeature(feature);_this2.remove_.getFeatures().clear();_this2.facadeMap_.getMapImpl().getTargetElement().style.cursor=""},{layerFilter:function layerFilter(layer){if(_this2.layer_&&layer==_this2.layer_)return true}})}},{key:"setPointerCursor_",value:function setPointerCursor_(evt){if(evt.selected.length){this.facadeMap_.getMapImpl().getTargetElement().style.cursor="pointer"}else{this.facadeMap_.getMapImpl().getTargetElement().style.cursor=""}}},{key:"saveAsKML",value:function saveAsKML(){if("Blob"in window){var fileName="map.kml";var content=(new ol.format.KML).writeFeatures(this.layer_.getSource().getFeatures(),{dataProjection:"EPSG:4326",featureProjection:this.facadeMap_.getProjection().code});var textFileAsBlob=new Blob([content],{type:"text/plain;charset=utf-8"});if("msSaveOrOpenBlob"in navigator){navigator.msSaveOrOpenBlob(textFileAsBlob,fileName)}else{var downloadLink=document.createElement("a");downloadLink.download=fileName;downloadLink.innerHTML="Download File";if("webkitURL"in window){downloadLink.href=window.webkitURL.createObjectURL(textFileAsBlob)}else{downloadLink.href=window.URL.createObjectURL(textFileAsBlob);downloadLink.onclick=this.destroyClickedElement;downloadLink.style.display="none";document.body.appendChild(downloadLink)}downloadLink.click()}}else{M.dialog.info("Tu navegador no soporta la descarga de ficheros Blob HML5")}}},{key:"destroyClickedElement_",value:function destroyClickedElement_(event){document.body.removeChild(event.target)}},{key:"activateDraw",value:function activateDraw(){if(!M.utils.isNullOrEmpty(this.draw_)){this.facadeMap_.getMapImpl().addInteraction(this.draw_)}}},{key:"activateRemove",value:function activateRemove(){if(!M.utils.isNullOrEmpty(this.remove_)){this.facadeMap_.getMapImpl().addInteraction(this.remove_);this.remove_.on("select",this.setPointerCursor_,this);this.facadeMap_.on(M.evt.CLICK,this.removeOnClick_,this)}}},{key:"activateModify",value:function activateModify(){if(!M.utils.isNullOrEmpty(this.modify_)){this.facadeMap_.getMapImpl().addInteraction(this.modify_)}}},{key:"deactivateDraw",value:function deactivateDraw(){if(!M.utils.isNullOrEmpty(this.draw_)){this.facadeMap_.getMapImpl().removeInteraction(this.draw_)}}},{key:"deactivateRemove",value:function deactivateRemove(){if(!M.utils.isNullOrEmpty(this.remove_)){this.facadeMap_.getMapImpl().removeInteraction(this.remove_)}}},{key:"deactivateModify",value:function deactivateModify(){if(!M.utils.isNullOrEmpty(this.modify_)){this.facadeMap_.getMapImpl().removeInteraction(this.modify_);this.layer_.un("select",this.setPointerCursor_,this);this.facadeMap_.un(M.evt.CLICK,this.removeOnClick_,this)}}}]);return DrawingControl}(M.impl.Control))||_class)},function(module,exports){}]);M.template.add("drawing.html",Handlebars.template({compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){return'<div class="m-control m-drawing-container">\r\n    \x3c!-- TITLE --\x3e\r\n    <div class="title">Herramienta de dibujo</div>\r\n    \x3c!-- Herramientas de ediciÃ³n de capas --\x3e\r\n    <div class="editor-tools">\r\n        <span>Seleccione una herramienta para crear o editar geometrÃ­as</span>\r\n        <div class="buttons tools">\r\n            <button class="add g-cartografia-editar" data-type="draw" title="AÃ±adir geometrÃ­a"></button>\r\n            <button class="modify g-cartografia-editar2" data-type="modify" title="Modificar geometrÃ­a"></button>\r\n            <button class="remove g-cartografia-menos2" data-type="remove" title="Eliminar geometrÃ­a seleccionada"></button>\r\n            <button class="removeall g-cartografia-papelera" data-type="removeall" title="Eliminar todas las geometrÃ­as"></button>\r\n            <button class="save g-cartografia-guardar" data-type="save" title="Guardar como KML"></button>\r\n        </div>\r\n    </div>\r\n    \x3c!-- Selector de geometrÃ­as --\x3e\r\n    <div class="geometry-selector dnone">\r\n        <span>Seleccione una geometrÃ­a para aÃ±adir a la capa</span>\r\n        <div class="buttons geometry">\r\n            <button class="point g-cartografia-pin2 active" title="AÃ±adir puntos" data-type="Point"></button>\r\n            <button class="line g-cartografia-linea" title="AÃ±adir lÃ­neas" data-type="LineString"></button>\r\n            <button class="polygon g-cartografia-poligono" title="AÃ±adir polÃ­gonos" data-type="Polygon"></button>\r\n        </div>\r\n    </div>\r\n</div>'},useData:true}));